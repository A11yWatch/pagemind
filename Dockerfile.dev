FROM --platform=$BUILDPLATFORM node:17.8-alpine3.14 AS BUILD_IMAGE

ENV CHROME_BIN="/usr/bin/chromium-browser" \
	PUPPETEER_SKIP_CHROMIUM_DOWNLOAD="true" \ 
	NODE_ENV="development"

RUN set -x \
	&& apk update \
	&& apk upgrade \
	&& apk add --no-cache \
	curl

WORKDIR /usr/src/app

COPY package*.json ./

RUN npm ci

COPY . .

EXPOSE 50052

CMD [ "npm", "run", "dev" ]
